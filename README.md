# AI 기반 개인 맞춤형 패션 추천 시스템

## 1. 프로젝트 배경

### 1.1. 국내외 시장 현황 및 문제점
기존의 날씨 기반 의상 추천 서비스는 대부분 현재 기온에 따른 단편적인 정보(예: "반팔을 입으세요")를 제공하거나, 사용자의 구매 내역에 기반한 상품 추천에 그치는 경우가 많습니다. 이러한 방식은 사용자가 이미 보유한 옷을 활용하지 못하고, '오늘 저녁 약속'과 같은 구체적인 상황(TPO)이나 개인의 옷장 특성을 전혀 고려하지 못하는 명백한 한계를 가집니다. 이로 인해 사용자는 정보의 홍수 속에서 오히려 "그래서 뭘 입어야 하지?"라는 '결정 피로'를 느끼게 됩니다.

### 1.2. 필요성과 기대효과
본 프로젝트는 이러한 문제를 해결하기 위해, **'상황 인지(Context-Aware)'** AI 모델을 통해 사용자의 실제 옷장을 기반으로 한 개인 맞춤형 추천을 제공할 필요성에서 출발했습니다. 본 시스템을 통해 사용자는 매일 아침 옷을 고르는 고민을 줄여 시간을 절약하고, 자신이 가진 옷으로 새로운 조합을 발견하여 불필요한 소비를 줄이는 **지속 가능한 패션 생활**을 실천할 수 있습니다. 최종적으로는 사용자의 만족도를 극대화하는 초개인화된 패션 추천 경험을 제공하는 것을 기대합니다.

---
## 2. 개발 목표

### 2.1. 목표 및 세부 내용
본 프로젝트의 최종 목표는 **'사용자의 옷장과 실시간 상황(날씨, TPO)을 종합적으로 이해하여, 논리적으로 적절하고 스타일리시한 옷 조합을 추천하는 AI 서버를 구축'**하는 것입니다.

* **주요 기능:**
    * **AI 기반 추천 엔진:** 사용자의 옷장, 날씨, 이벤트 정보가 담긴 복합적인 요청을 받아 최적의 옷 조합(ID 목록)과 추천 사유를 반환하는 API.
    * **상황 인지:** 온도, 날씨 상태(맑음, 비 등), 이벤트의 격식(Formal, Casual 등)을 이해하고 추천에 반영.
    * **2단계 평가 시스템:** '개별 아이템 평가'와 '최종 조합 평가'를 순차적으로 진행하여 추천의 속도와 정확도를 동시에 확보.
    * **지능형 폴백:** 추천 가능한 조합이 없을 경우, 기준을 유연하게 완화하여 차선책이라도 제시하는 견고한 시스템.

### 2.2. 기존 서비스 대비 차별성
본 시스템은 단순한 필터링이나 통계 기반의 추천을 넘어, 최신 언어 모델인 **Google의 Gemma-2B-IT**를 **DPO(Direct Preference Optimization)** 방식으로 미세 조정하여 차별성을 확보했습니다. 이를 통해 모델은 "A 조합이 B 조합보다 더 낫다"와 같은 인간의 미묘한 선호도를 학습하여, 단순 규칙으로는 구현하기 어려운 **상황에 대한 깊은 이해**를 바탕으로 추천을 생성합니다. 또한, AI의 판단과 코드 기반의 상식 규칙을 결합한 **'하이브리드 스코어링'** 및 **'2단계 평가'** 아키텍처는 본 시스템만이 가진 독창적인 설계입니다.

### 2.3. 사회적 가치 도입 계획
본 프로젝트는 사용자가 이미 소유한 의류의 활용도를 극대화하여 새로운 옷의 구매를 줄이도록 유도합니다. 이는 의류 폐기물을 감소시키고 충동적인 소비를 억제하는 **지속 가능한 패션(Sustainable Fashion)** 문화를 장려하는 사회적 가치를 지닙니다.

---
### 3. 시스템 설계

#### 3.1. 시스템 구성도
이 시스템은 클라이언트, 백엔드, 그리고 데이터 저장소로 구성되어 있습니다. 전체적인 데이터 흐름은 다음과 같습니다.

#### 1. 클라이언트 (Client): iOS 시뮬레이터에서 실행되는 Flutter 앱이 사용자와의 상호작용을 담당합니다.

#### 2. 통신 (Communication):

* 클라이언트는 ngrok이 생성한 공개 URL 주소로 HTTPS를 통해 API 요청을 보냅니다.

* ngrok은 외부의 요청을 내부에서 실행 중인 백엔드 서버로 안전하게 연결해주는 터널링(Tunneling) 역할을 합니다.

#### 3. 백엔드 (Backend):

* 백엔드 서버는 Google Colab 환경에서 실행됩니다.

* Colab 환경 내에서는 FastAPI 서버(serve_final.py 파일)가 클라이언트의 요청을 받아 처리합니다.

* 서버는 T4 또는 A100 GPU 상에서 동작하는 Gemma DPO 모델을 사용하여 핵심 기능을 수행합니다.

* 이 모델은 styles.csv 파일에 저장된 의류 데이터를 참조합니다.

#### 4. 영구 저장소 (Persistent Storage):

* 학습된 모델과 데이터는 Google Drive에 영구적으로 저장됩니다.

* 저장되는 주요 파일은 학습된 모델인 **gemma-fashion-dpo-final-v3.zip**과 의류 데이터인 styles.csv 입니다.

#### 3.2. 사용 기술
* **Frontend:** Flutter, Dart
* **Backend & AI:**
    * **Server:** Python 3.12, FastAPI, Uvicorn
    * **AI Model:** Google Gemma-2B-IT
    * **Fine-tuning:** PEFT/LoRA, DPO (Direct Preference Optimization) with `trl` library
    * **Core Libraries:** `transformers`, `torch`, `pandas`, `accelerate`
* **Deployment:** Google Colab (T4 GPU), Google Drive (Data Persistence), `ngrok` (Tunneling)

---
### 4. 개발 결과

#### 4.1. 전체 시스템 흐름도
1.  **요청 수신:** 클라이언트(Flutter 앱)가 사용자 옷장, 현재 날씨, 이벤트 정보를 담아 Colab 서버의 ngrok 주소로 API를 요청합니다.
2.  **지능형 필터링:** 서버는 온도와 이벤트(TPO)에 맞춰 1차적으로 엄격한 기준(계절+상황)으로 옷을 필터링합니다. 만약 필수 아이템이 부족하면, 기준을 완화(계절만)하여 2차 필터링을 수행합니다.
3.  **1차 AI 평가:** 필터링된 개별 의류 아이템 각각에 대해 AI가 상황 적합도 점수를 매깁니다.
4.  **후보군 생성:** 각 부위별(상의, 하의 등)로 AI 점수가 높은 상위 아이템(Top-K)만을 선별하여, 소수의 고품질 조합 후보군을 생성합니다.
5.  **2차 AI 평가:** 생성된 고품질 조합들을 다시 AI에게 보내, 조합 전체의 조화로움을 평가하여 최종 AI 점수를 매깁니다.
6.  **하이브리드 스코어링:** AI 점수에 코드 기반의 '상식 규칙 점수'(예: 추운 날 아우터 보너스)를 합산하여 최종 점수를 계산합니다.
7.  **응답 반환:** 최종 점수가 가장 높은 조합을 선택하여, 추천된 옷 ID 목록과 설명 등을 JSON 형태로 클라이언트에게 반환합니다.

#### 4.2. 기능 설명 및 주요 기능 명세서
* **Endpoint:** `POST /recommend_outfit`
* **Input (Request Body):**
    ```json
    {
      "closet": [15970, 59435, ...],
      "event": "Business Meeting",
      "temperature": 15.0,
      "condition": "Cloudy",
      "gender": "Men"
    }
    ```
* **Output (Response Body):**
    ```json
    {
      "best_combination": {
        "description": "상의(Navy Blue Shirts...), 하의(...)",
        "ids": [15970, 14392, ...]
      },
      "explanation": "긍정적: 15.0°C의 Cloudy 날씨에...",
      "best_score": 1.1896,
      "processing_time": 5.84
    }
    ```

#### 4.3. 디렉토리 구조

프로젝트는 클라우드 환경과 로컬 개발 환경으로 나뉩니다.

#### 클라우드 환경 (Google Drive)

* Google Drive의 MyDrive/Colab Notebooks/fashion_project/ 경로 아래에 다음과 같은 파일들이 있습니다.

* gemma-fashion-dpo-final-v3.zip: Colab에서 학습을 완료한 후 업로드할 AI 모델 파일입니다.

* styles.csv: 모델이 참조하는 의류 메타데이터 파일입니다.

* server_final.ipynb: Google Colab에서 FastAPI 백엔드 서버를 실행하기 위한 Jupyter Notebook 파일입니다.

#### 로컬 개발 환경 (macOS)

* 로컬 머신의 local_project/ 폴더 아래에 다음과 같이 구성됩니다.

* test_api.py: 개발 중인 백엔드 API의 기능을 테스트하기 위한 Python 스크립트입니다.

* flutter_app/: 프론트엔드를 담당하는 Flutter 프로젝트의 루트 디렉토리입니다.

* lib/main.dart: Flutter 앱의 메인 로직이 담긴 Dart 코드 파일입니다.

* pubspec.yaml: Flutter 프로젝트의 의존성 및 설정을 관리하는 파일입니다.

#### 4.4. 산업체 멘토링 의견 및 반영 사항

* **멘토링 의견:** "구체적인 gemma 버전과 결과 튜닝에 대해서 보완이 필요함"
* **반영 사항:** "피드백을 반영하여, gemma 버전을 구체화하고 결과 튜닝을 실시하였음"

---
### 5. 설치 및 실행 방법

#### 5.1. 설치절차 및 실행 방법
1.  **사전 준비:** Google Drive 특정 경로(예: `My Drive/Colab Notebooks/fashion_project/`)에 `gemma-fashion-dpo-final-v3.zip`과 `styles.csv` 파일을 업로드합니다.
2.  **Colab 노트북 실행:** 제공된 최종 Colab 실행 노트북(`server_v6_5_dpo-6.ipynb` 등)을 엽니다.
3.  **런타임 설정:** 런타임 유형을 `T4 GPU`로 설정합니다.
4.  **셀 실행:** 노트북의 모든 셀을 순서대로 실행합니다. 중간에 Hugging Face 및 ngrok 인증 토큰을 입력해야 합니다.
5.  **서버 실행 확인:** 셀 실행이 완료되면, `https://<...>.ngrok-free.app` 형태의 Public URL이 출력됩니다.
6.  **포트 정보:** 서버는 Colab 내부적으로 `8000`번 포트를 사용합니다.

#### 5.2. 오류 발생 시 해결 방법
* **`CUDA error` / `bitsandbytes` 오류:** Colab `런타임 > 런타임 다시 시작`으로 환경을 초기화한 뒤, 라이브러리 설치 셀부터 다시 실행하면 대부분 해결됩니다.
* **`ngrok` 연결 오류:** ngrok 토큰이 올바른지 확인하고, Colab 셀을 재실행하여 새로운 주소를 발급받아 사용합니다.
* **파일 경로 오류:** Google Drive의 프로젝트 폴더 경로(`PROJECT_DIR`)가 정확한지, 해당 폴더에 필요한 파일들이 모두 있는지 확인합니다.

---
### 6. 소개 자료 및 시연 영상

#### 6.1. 프로젝트 소개 자료
*/docs/발표자료에 업로드했습니다.*

#### 6.2. 시연 영상
* (https://youtube.com/watch?v=y29PbEt5UK8&si=wUS7sbWiiu4c3M2o)

---
### 7. 팀 구성

#### 7.1. 팀원별 소개 및 역할 분담

* **호노카:** 프론트엔드·백엔드 총괄. Flutter로 로그인·회원가입·홈·의류 등록·일정·날씨 연동 화면 구현 및 UX 정비. Django+PostgreSQL 백엔드 아키텍처 설계, 인증/권한, 외부 기상 API·AI 서버 연동, 마이그레이션 검토. 팀과 협업했으나 백엔드 핵심 구현과 서비스 통합은 총괄해서 담당.
* **신상협:** AI 모델 설계 및 개발. Gemma 모델 DPO Fine-tuning, FastAPI 서버 아키텍처 설계 및 구축, 성능 최적화 및 전체 시스템 통합을 주도함.
* **마디나:** PostgreSQL 기반 데이터베이스 모델을 설계함. Django ORM으로 연동함. Users, Clothess, Events 테이블을 정의하고 마이그레이션을 완료함. 회원가입 및 로그인 기능을 구현하여 사용자 인증을 처리함.


#### 7.2. 팀원 별 참여 후기

* **호노카:** "제품 완성도를 위해 실구현 책임을 끝까지 가져갔다. 백엔드 핵심과 연동 이슈를 선제적으로 해결하며 의사결정 속도를 높였다. 전체 시스템을 관통하는 시야가 성능과 안정성에 직결됨을 확인한 좋은 경험이었습니다."
* **신상협:** "최신 AI 기술인 DPO를 직접 적용해보며 모델의 성능을 극한으로 끌어올리는 과정이 흥미로웠습니다. 특히, 수많은 기술적 난제를 해결하며 얻은 문제 해결 능력은 큰 자산이 될 것 같습니다. 팀원들과의 협업을 통해 아이디어를 실제 작동하는 서비스로 만들어낸 경험은 매우 값졌습니다."
* **마디나:** "데이터베이스 설계와 인증 기능 구현을 맡으며 서비스 구조에 대한 이해를 넓힐 수 있었습니다. 엔드포인트 구축과 추천 로직 연동 과정에서 협업의 중요성을 느꼈고, 다양한 문제를 해결하며 실무적인 경험을 쌓을 수 있었습니다."

## 대용량 데이터 파일 안내

학습에 필요한 `gemma-fashion-dpo-final-v3.zip` 파일은 GitHub Releases 페이지에서 다운로드할 수 있습니다.

[**데이터 다운로드 페이지 바로가기**](https://github.com/pnucse-capstone2025/Capstone-2025-team-33/releases)
